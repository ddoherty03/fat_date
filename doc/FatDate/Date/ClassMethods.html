<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Module: FatDate::Date::ClassMethods
  
    &mdash; Documentation by YARD 0.9.38
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "FatDate::Date::ClassMethods";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../FatDate.html" title="FatDate (module)">FatDate</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Date.html" title="FatDate::Date (module)">Date</a></span></span>
     &raquo; 
    <span class="title">ClassMethods</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Module: FatDate::Date::ClassMethods
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/fat_date/date.rb</dd>
  </dl>
  
</div>


  
    <h2>
      Utilities
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="COMMON_YEAR_DAYS_IN_MONTH-constant" class="">COMMON_YEAR_DAYS_IN_MONTH =
          <div class="docstring">
  <div class="discussion">
    <p>An Array of the number of days in each month indexed by month number,
starting with January = 1, etc.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbracket'>[</span>
  <span class='int'>31</span><span class='comma'>,</span>
  <span class='int'>31</span><span class='comma'>,</span>
  <span class='int'>28</span><span class='comma'>,</span>
  <span class='int'>31</span><span class='comma'>,</span>
  <span class='int'>30</span><span class='comma'>,</span>
  <span class='int'>31</span><span class='comma'>,</span>
  <span class='int'>30</span><span class='comma'>,</span>
  <span class='int'>31</span><span class='comma'>,</span>
  <span class='int'>31</span><span class='comma'>,</span>
  <span class='int'>30</span><span class='comma'>,</span>
  <span class='int'>31</span><span class='comma'>,</span>
  <span class='int'>30</span><span class='comma'>,</span>
  <span class='int'>31</span>
<span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_freeze'>freeze</span></pre></dd>
      
        <dt id="GOLDEN_TO_FULLMOON-constant" class="">GOLDEN_TO_FULLMOON =
          <div class="docstring">
  <div class="discussion">
    <p>Map from &quot;golden number&quot; (y % 19) of year to month and day of Pachal
full moon.  From
<a href="https://www.calendarbede.com/book/calculation-julian-easter-sunday">https://www.calendarbede.com/book/calculation-julian-easter-sunday</a></p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='lbrace'>{</span>
  <span class='int'>1</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>5</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>2</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>25</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>3</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>13</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>4</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>5</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>22</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>6</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>10</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>7</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>30</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>8</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>18</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>9</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>7</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>10</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>27</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>11</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>15</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>12</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>4</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>13</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>24</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>14</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>12</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>15</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>16</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>21</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>17</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>9</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>18</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>3</span><span class='comma'>,</span> <span class='int'>29</span><span class='rbracket'>]</span><span class='comma'>,</span>
  <span class='int'>19</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='int'>4</span><span class='comma'>,</span> <span class='int'>17</span><span class='rbracket'>]</span><span class='comma'>,</span>
<span class='rbrace'>}</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Parsing
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#parse_american-instance_method" title="#parse_american (instance method)">#<strong>parse_american</strong>(str)  &#x21d2; ::Date </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Convert a string +str+ with an American style date into a ::Date object.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#spec-instance_method" title="#spec (instance method)">#<strong>spec</strong>(spec, spec_type = :from)  &#x21d2; ::Date </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Convert a &#39;period spec&#39; <code>spec</code> to a ::Date.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Utilities
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#days_in_month-instance_method" title="#days_in_month (instance method)">#<strong>days_in_month</strong>(year, month)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#dow_to_wday-instance_method" title="#dow_to_wday (instance method)">#<strong>dow_to_wday</strong>(s)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Return the wday number for the given DOW string allowing flexibility on how the days are written.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#easter-instance_method" title="#easter (instance method)">#<strong>easter</strong>(year, reform_year: 1582)  &#x21d2; ::Date </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Return the date of Easter for the Western Church in the given year, accounting for calendar reform.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ensure-instance_method" title="#ensure (instance method)">#<strong>ensure</strong>(dat)  &#x21d2; Date, DateTime </a>
    

    
      (also: #ensure_date)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Ensure that date is of class Date based either on a string or Date object or an object that responds to #to_date or #to_datetime.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#mo_name_to_num-instance_method" title="#mo_name_to_num (instance method)">#<strong>mo_name_to_num</strong>(name)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Return the 1-indexed integer that corresponds to a month name.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#nth_wday_in_year_month-instance_method" title="#nth_wday_in_year_month (instance method)">#<strong>nth_wday_in_year_month</strong>(nth, wday, year, month)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Return the nth weekday in the given month.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#roman_to_week-instance_method" title="#roman_to_week (instance method)">#<strong>roman_to_week</strong>(s)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Return the week number indicated by roman numerals i to vi, regardless of case.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="days_in_month-instance_method">
  
    #<strong>days_in_month</strong>(year, month)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1773
1774
1775
1776
1777
1778
1779
1780
1781
1782</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fat_date/date.rb', line 1773</span>

<span class='kw'>def</span> <span class='id identifier rubyid_days_in_month'>days_in_month</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>illegal month number</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_month'>month</span> <span class='op'>&lt;</span> <span class='int'>1</span> <span class='op'>||</span> <span class='id identifier rubyid_month'>month</span> <span class='op'>&gt;</span> <span class='int'>12</span>

  <span class='id identifier rubyid_days'>days</span> <span class='op'>=</span> <span class='const'><span class='object_link'><a href="#COMMON_YEAR_DAYS_IN_MONTH-constant" title="FatDate::Date::ClassMethods::COMMON_YEAR_DAYS_IN_MONTH (constant)">COMMON_YEAR_DAYS_IN_MONTH</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_month'>month</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_month'>month</span> <span class='op'>==</span> <span class='int'>2</span>
    <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_leap?'>leap?</span> <span class='op'>?</span> <span class='int'>29</span> <span class='op'>:</span> <span class='int'>28</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_days'>days</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="dow_to_wday-instance_method">
  
    #<strong>dow_to_wday</strong>(s)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Return the wday number for the given DOW string allowing flexibility
on how the days are written</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1876
1877
1878
1879
1880
1881
1882
1883
1884
1885
1886
1887
1888
1889
1890
1891
1892
1893
1894
1895</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fat_date/date.rb', line 1876</span>

<span class='kw'>def</span> <span class='id identifier rubyid_dow_to_wday'>dow_to_wday</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_clean'>clean</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\ASu</span><span class='regexp_end'>/i</span></span>
    <span class='int'>0</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\AMo</span><span class='regexp_end'>/i</span></span>
    <span class='int'>1</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\ATu</span><span class='regexp_end'>/i</span></span>
    <span class='int'>2</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\AWe</span><span class='regexp_end'>/i</span></span>
    <span class='int'>3</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\ATh</span><span class='regexp_end'>/i</span></span>
    <span class='int'>4</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\AFr</span><span class='regexp_end'>/i</span></span>
    <span class='int'>5</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\ASa</span><span class='regexp_end'>/i</span></span>
    <span class='int'>6</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>There is no weekday named </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="easter-instance_method">
  
    #<strong>easter</strong>(year, reform_year: 1582)  &#x21d2; <tt><span class='object_link'><a href="../../Date.html" title="Date (class)">::Date</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Return the date of Easter for the Western Church in the given year,
accounting for calendar reform.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>year</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the year of interest</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>reform_year</span>
      
      
        <span class='type'>(<tt>Integer</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>1582</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>the year of Gregorian calendar adoption (default: 1582)</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Date.html" title="Date (class)">::Date</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the date of Easter for year</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1969
1970
1971
1972
1973
1974
1975
1976
1977
1978
1979
1980
1981
1982
1983
1984
1985
1986
1987
1988
1989
1990
1991
1992
1993
1994
1995
1996
1997
1998
1999
2000
2001
2002
2003
2004
2005
2006</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fat_date/date.rb', line 1969</span>

<span class='kw'>def</span> <span class='id identifier rubyid_easter'>easter</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='label'>reform_year:</span> <span class='int'>1582</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>date</span><span class='tstring_end'>&#39;</span></span>
  <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='id identifier rubyid_year'>year</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_y'>y</span> <span class='op'>=</span> <span class='id identifier rubyid_year'>year</span>
  <span class='comment'># No Easter before the Resurrection!
</span>  <span class='kw'>return</span> <span class='kw'>if</span> <span class='id identifier rubyid_year'>year</span> <span class='op'>&lt;</span> <span class='int'>30</span>

  <span class='comment'># Note that since the reform took place in October 1582 in Catholic
</span>  <span class='comment'># Europe and in Spetember 1752 in England
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>&lt;=</span> <span class='id identifier rubyid_reform_year'>reform_year</span>
    <span class='id identifier rubyid_golden'>golden</span> <span class='op'>=</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>%</span> <span class='int'>19</span> <span class='op'>+</span> <span class='int'>1</span>
    <span class='id identifier rubyid_p_full'>p_full</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span>
      <span class='id identifier rubyid_y'>y</span><span class='comma'>,</span>
      <span class='const'><span class='object_link'><a href="#GOLDEN_TO_FULLMOON-constant" title="FatDate::Date::ClassMethods::GOLDEN_TO_FULLMOON (constant)">GOLDEN_TO_FULLMOON</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_golden'>golden</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span>
      <span class='const'><span class='object_link'><a href="#GOLDEN_TO_FULLMOON-constant" title="FatDate::Date::ClassMethods::GOLDEN_TO_FULLMOON (constant)">GOLDEN_TO_FULLMOON</a></span></span><span class='lbracket'>[</span><span class='id identifier rubyid_golden'>golden</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span>
    <span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_p_full'>p_full</span><span class='period'>.</span><span class='id identifier rubyid_wday'>wday</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
      <span class='id identifier rubyid_p_full'>p_full</span> <span class='op'>+</span> <span class='int'>7</span><span class='period'>.</span><span class='id identifier rubyid_days'>days</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_easter'>easter</span> <span class='op'>=</span> <span class='id identifier rubyid_p_full'>p_full</span>
      <span class='id identifier rubyid_easter'>easter</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='kw'>until</span> <span class='id identifier rubyid_easter'>easter</span><span class='period'>.</span><span class='id identifier rubyid_wday'>wday</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
      <span class='id identifier rubyid_easter'>easter</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='comment'># Gregorian calendar calculation (original code)
</span>    <span class='id identifier rubyid_a'>a</span> <span class='op'>=</span> <span class='id identifier rubyid_y'>y</span> <span class='op'>%</span> <span class='int'>19</span>
    <span class='id identifier rubyid_b'>b</span><span class='comma'>,</span> <span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='id identifier rubyid_y'>y</span><span class='period'>.</span><span class='id identifier rubyid_divmod'>divmod</span><span class='lparen'>(</span><span class='int'>100</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_d'>d</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>=</span> <span class='id identifier rubyid_b'>b</span><span class='period'>.</span><span class='id identifier rubyid_divmod'>divmod</span><span class='lparen'>(</span><span class='int'>4</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span> <span class='op'>+</span> <span class='int'>8</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>25</span>
    <span class='id identifier rubyid_g'>g</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_b'>b</span> <span class='op'>-</span> <span class='id identifier rubyid_f'>f</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>3</span>
    <span class='id identifier rubyid_h'>h</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>19</span> <span class='op'>*</span> <span class='id identifier rubyid_a'>a</span> <span class='op'>+</span> <span class='id identifier rubyid_b'>b</span> <span class='op'>-</span> <span class='id identifier rubyid_d'>d</span> <span class='op'>-</span> <span class='id identifier rubyid_g'>g</span> <span class='op'>+</span> <span class='int'>15</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='int'>30</span>
    <span class='id identifier rubyid_i'>i</span><span class='comma'>,</span> <span class='id identifier rubyid_k'>k</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_divmod'>divmod</span><span class='lparen'>(</span><span class='int'>4</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_l'>l</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='int'>32</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_e'>e</span> <span class='op'>+</span> <span class='int'>2</span> <span class='op'>*</span> <span class='id identifier rubyid_i'>i</span> <span class='op'>-</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>-</span> <span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span> <span class='op'>%</span> <span class='int'>7</span>
    <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_a'>a</span> <span class='op'>+</span> <span class='int'>11</span> <span class='op'>*</span> <span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='int'>22</span> <span class='op'>*</span> <span class='id identifier rubyid_l'>l</span><span class='rparen'>)</span> <span class='op'>/</span> <span class='int'>451</span>
    <span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_h'>h</span> <span class='op'>+</span> <span class='id identifier rubyid_l'>l</span> <span class='op'>-</span> <span class='int'>7</span> <span class='op'>*</span> <span class='id identifier rubyid_m'>m</span> <span class='op'>+</span> <span class='int'>114</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_divmod'>divmod</span><span class='lparen'>(</span><span class='int'>31</span><span class='rparen'>)</span>
    <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_y'>y</span><span class='comma'>,</span> <span class='id identifier rubyid_n'>n</span><span class='comma'>,</span> <span class='id identifier rubyid_p'>p</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ensure-instance_method">
  
    #<strong>ensure</strong>(dat)  &#x21d2; <tt><span class='object_link'><a href="../Date.html" title="FatDate::Date (module)">Date</a></span></tt>, <tt><span class='object_link'><a href="../DateTime.html" title="FatDate::DateTime (module)">DateTime</a></span></tt> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='ensure_date-instance_method'>ensure_date</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Ensure that date is of class Date based either on a string or Date
object or an object that responds to #to_date or #to_datetime.  If the
given object is a String, use Date.parse to try to convert it.</p>

<p>If given a DateTime, it returns the unrounded DateTime; if given a
Time, it converts it to a DateTime.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>dat</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt><span class='object_link'><a href="../Date.html" title="FatDate::Date (module)">Date</a></span></tt>, <tt>Time</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the object to be converted to Date</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../Date.html" title="FatDate::Date (module)">Date</a></span></tt>, <tt><span class='object_link'><a href="../DateTime.html" title="FatDate::DateTime (module)">DateTime</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2017
2018
2019
2020
2021
2022
2023
2024
2025
2026
2027
2028
2029
2030
2031
2032
2033
2034
2035</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fat_date/date.rb', line 2017</span>

<span class='kw'>def</span> <span class='kw'>ensure</span><span class='lparen'>(</span><span class='id identifier rubyid_dat'>dat</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_dat'>dat</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../Date.html" title="FatDate::Date (module)">Date</a></span></span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_dat'>dat</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'><span class='object_link'><a href="../DateTime.html" title="FatDate::DateTime (module)">DateTime</a></span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dat'>dat</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_dat'>dat</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Time</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dat'>dat</span><span class='period'>.</span><span class='id identifier rubyid_to_datetime'>to_datetime</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_dat'>dat</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:to_datetime</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dat'>dat</span><span class='period'>.</span><span class='id identifier rubyid_to_datetime'>to_datetime</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_dat'>dat</span><span class='period'>.</span><span class='id identifier rubyid_respond_to?'>respond_to?</span><span class='lparen'>(</span><span class='symbol'>:to_date</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_dat'>dat</span><span class='period'>.</span><span class='id identifier rubyid_to_date'>to_date</span>
  <span class='kw'>elsif</span> <span class='id identifier rubyid_dat'>dat</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_dat'>dat</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='op'>::</span><span class='const'>Error</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cannot convert string &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dat'>dat</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; to a Date or DateTime</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>cannot convert class &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dat'>dat</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; to a Date or DateTime</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="mo_name_to_num-instance_method">
  
    #<strong>mo_name_to_num</strong>(name)  &#x21d2; <tt>Integer</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Return the 1-indexed integer that corresponds to a month name.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a name of a month</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the integer integer that corresponds to a month
name, or nil of no month recognized.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1790
1791
1792
1793
1794
1795
1796
1797
1798
1799
1800
1801
1802
1803
1804
1805
1806
1807
1808
1809
1810
1811
1812
1813
1814
1815
1816
1817</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fat_date/date.rb', line 1790</span>

<span class='kw'>def</span> <span class='id identifier rubyid_mo_name_to_num'>mo_name_to_num</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_name'>name</span><span class='period'>.</span><span class='id identifier rubyid_clean'>clean</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Ajan</span><span class='regexp_end'>/i</span></span>
    <span class='int'>1</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Afeb</span><span class='regexp_end'>/i</span></span>
    <span class='int'>2</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Amar</span><span class='regexp_end'>/i</span></span>
    <span class='int'>3</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Aapr</span><span class='regexp_end'>/i</span></span>
    <span class='int'>4</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Amay</span><span class='regexp_end'>/i</span></span>
    <span class='int'>5</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Ajun</span><span class='regexp_end'>/i</span></span>
    <span class='int'>6</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Ajul</span><span class='regexp_end'>/i</span></span>
    <span class='int'>7</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Aaug</span><span class='regexp_end'>/i</span></span>
    <span class='int'>8</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Asep</span><span class='regexp_end'>/i</span></span>
    <span class='int'>9</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Aoct</span><span class='regexp_end'>/i</span></span>
    <span class='int'>10</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Anov</span><span class='regexp_end'>/i</span></span>
    <span class='int'>11</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Adec</span><span class='regexp_end'>/i</span></span>
    <span class='int'>12</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="nth_wday_in_year_month-instance_method">
  
    #<strong>nth_wday_in_year_month</strong>(nth, wday, year, month)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Return the nth weekday in the given month. If n is negative, count from
last day of month.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>nth</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the ordinal number for the weekday</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>wday</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the weekday of interest with Sunday 0 to Saturday 6</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>year</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the year of interest</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>month</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the month of interest with January 1 to December 12</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1826
1827
1828
1829
1830
1831
1832
1833
1834
1835
1836
1837
1838
1839
1840
1841
1842
1843
1844
1845
1846
1847
1848
1849
1850
1851
1852
1853
1854
1855
1856
1857
1858
1859
1860
1861
1862
1863
1864
1865
1866
1867
1868
1869
1870
1871
1872</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fat_date/date.rb', line 1826</span>

<span class='kw'>def</span> <span class='id identifier rubyid_nth_wday_in_year_month'>nth_wday_in_year_month</span><span class='lparen'>(</span><span class='id identifier rubyid_nth'>nth</span><span class='comma'>,</span> <span class='id identifier rubyid_wday'>wday</span><span class='comma'>,</span> <span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_wday'>wday</span> <span class='op'>=</span> <span class='id identifier rubyid_wday'>wday</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>illegal weekday number</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_wday'>wday</span><span class='period'>.</span><span class='id identifier rubyid_negative?'>negative?</span> <span class='op'>||</span> <span class='id identifier rubyid_wday'>wday</span> <span class='op'>&gt;</span> <span class='int'>6</span>

  <span class='id identifier rubyid_month'>month</span> <span class='op'>=</span> <span class='id identifier rubyid_month'>month</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>illegal month number</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_month'>month</span> <span class='op'>&lt;</span> <span class='int'>1</span> <span class='op'>||</span> <span class='id identifier rubyid_month'>month</span> <span class='op'>&gt;</span> <span class='int'>12</span>

  <span class='id identifier rubyid_nth'>nth</span> <span class='op'>=</span> <span class='id identifier rubyid_nth'>nth</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_nth'>nth</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span> <span class='op'>&gt;</span> <span class='int'>5</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_nth'>nth</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='embexpr_end'>}</span><span class='tstring_content'> out of range: can be no more than 5 of any day of the week in any month</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_nth'>nth</span><span class='period'>.</span><span class='id identifier rubyid_positive?'>positive?</span>
      <span class='comment'># Set d to the 1st wday in month
</span>      <span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_d'>d</span> <span class='op'>+=</span> <span class='int'>1</span> <span class='kw'>while</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_wday'>wday</span> <span class='op'>!=</span> <span class='id identifier rubyid_wday'>wday</span>
      <span class='comment'># Set d to the nth wday in month
</span>      <span class='id identifier rubyid_nd'>nd</span> <span class='op'>=</span> <span class='int'>1</span>
      <span class='kw'>while</span> <span class='id identifier rubyid_nd'>nd</span> <span class='op'>!=</span> <span class='id identifier rubyid_nth'>nth</span>
        <span class='id identifier rubyid_d'>d</span> <span class='op'>+=</span> <span class='int'>7</span>
        <span class='id identifier rubyid_nd'>nd</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_d'>d</span>
    <span class='kw'>elsif</span> <span class='id identifier rubyid_nth'>nth</span><span class='period'>.</span><span class='id identifier rubyid_negative?'>negative?</span>
      <span class='id identifier rubyid_nth'>nth</span> <span class='op'>=</span> <span class='op'>-</span><span class='id identifier rubyid_nth'>nth</span>
      <span class='comment'># Set d to the last wday in month
</span>      <span class='id identifier rubyid_d'>d</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_end_of_month'>end_of_month</span>
      <span class='id identifier rubyid_d'>d</span> <span class='op'>-=</span> <span class='int'>1</span> <span class='kw'>while</span> <span class='id identifier rubyid_d'>d</span><span class='period'>.</span><span class='id identifier rubyid_wday'>wday</span> <span class='op'>!=</span> <span class='id identifier rubyid_wday'>wday</span>
      <span class='comment'># Set d to the nth wday in month
</span>      <span class='id identifier rubyid_nd'>nd</span> <span class='op'>=</span> <span class='int'>1</span>
      <span class='kw'>while</span> <span class='id identifier rubyid_nd'>nd</span> <span class='op'>!=</span> <span class='id identifier rubyid_nth'>nth</span>
        <span class='id identifier rubyid_d'>d</span> <span class='op'>-=</span> <span class='int'>7</span>
        <span class='id identifier rubyid_nd'>nd</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_d'>d</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Argument nth cannot be zero</span><span class='tstring_end'>&#39;</span></span>
    <span class='kw'>end</span>

  <span class='id identifier rubyid_dow'>dow</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Sunday</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Monday</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Tuesday</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Wednesday</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Thursday</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Friday</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Saturday</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_wday'>wday</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_month'>month</span> <span class='op'>!=</span> <span class='id identifier rubyid_month'>month</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>There is no </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_nth'>nth</span><span class='embexpr_end'>}</span><span class='tstring_content'>th </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_dow'>dow</span><span class='embexpr_end'>}</span><span class='tstring_content'> in </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_year'>year</span><span class='embexpr_end'>}</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_month'>month</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="parse_american-instance_method">
  
    #<strong>parse_american</strong>(str)  &#x21d2; <tt><span class='object_link'><a href="../../Date.html" title="Date (class)">::Date</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Convert a string +str+ with an American style date into a ::Date object</p>

<p>An American style date is of the form <code>MM/DD/YYYY</code>, that is it places the
month first, then the day of the month, and finally the year. The European
convention is typically to place the day of the month first, <code>DD/MM/YYYY</code>.
A date found in the wild can be ambiguous, e.g. 3/5/2014, but a date
string known to be using the American convention can be parsed using this
method. Both the month and the day can be a single digit. The year can be
either 2 or 4 digits, and if given as 2 digits, it adds 2000 to it to give
the year.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse_american'>parse_american</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>9/11/2001</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span> <span class='comment'>#=&gt; ::Date(2011, 9, 11)
</span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse_american'>parse_american</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>9/11/01</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>   <span class='comment'>#=&gt; ::Date(2011, 9, 11)
</span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_parse_american'>parse_american</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>9/11/1</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>    <span class='comment'>#=&gt; ArgumentError</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>str</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>#to_s</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>a stringling of the form MM/DD/YYYY</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Date.html" title="Date (class)">::Date</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the date represented by the str paramenter.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1453
1454
1455
1456
1457
1458
1459
1460
1461
1462
1463
1464</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fat_date/date.rb', line 1453</span>

<span class='kw'>def</span> <span class='id identifier rubyid_parse_american'>parse_american</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_re'>re</span> <span class='op'>=</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\A\s*(\d\d?)\s*[-/]\s*(\d\d?)\s*[-/]\s*((\d\d)?\d\d)\s*\z</span><span class='regexp_end'>}</span></span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_str'>str</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>=~</span> <span class='id identifier rubyid_re'>re</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>date string must be of form &#39;MM?/DD?/YY(YY)?&#39;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='backref'>$3</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_month'>month</span> <span class='op'>=</span> <span class='backref'>$1</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_day'>day</span> <span class='op'>=</span> <span class='backref'>$2</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
  <span class='id identifier rubyid_year'>year</span> <span class='op'>+=</span> <span class='int'>2000</span> <span class='kw'>if</span> <span class='id identifier rubyid_year'>year</span> <span class='op'>&lt;</span> <span class='int'>100</span>
  <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="roman_to_week-instance_method">
  
    #<strong>roman_to_week</strong>(s)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Return the week number indicated by roman numerals i to vi, regardless
of case.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1899
1900
1901
1902
1903
1904
1905
1906
1907
1908
1909
1910
1911
1912
1913
1914
1915
1916</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fat_date/date.rb', line 1899</span>

<span class='kw'>def</span> <span class='id identifier rubyid_roman_to_week'>roman_to_week</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span><span class='rparen'>)</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_s'>s</span><span class='period'>.</span><span class='id identifier rubyid_clean'>clean</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Ai\z</span><span class='regexp_end'>/i</span></span>
    <span class='int'>1</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Aii\z</span><span class='regexp_end'>/i</span></span>
    <span class='int'>2</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Aiii\z</span><span class='regexp_end'>/i</span></span>
    <span class='int'>3</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Aiv\z</span><span class='regexp_end'>/i</span></span>
    <span class='int'>4</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Av\z</span><span class='regexp_end'>/i</span></span>
    <span class='int'>5</span>
  <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\Avi\z</span><span class='regexp_end'>/i</span></span>
    <span class='int'>6</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>There is no week number </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s'>s</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="spec-instance_method">
  
    #<strong>spec</strong>(spec, spec_type = :from)  &#x21d2; <tt><span class='object_link'><a href="../../Date.html" title="Date (class)">::Date</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Convert a &#39;period spec&#39; <code>spec</code> to a ::Date. A date spec is a short-hand way of
specifying a calendar period either absolutely or relative to the computer
clock. This method returns the first date of that period, when <code>spec_type</code>
is set to <code>:from</code>, the default, and returns the last date of the period
when <code>spec_type</code> is <code>:to</code>.</p>

<p>There are a number of forms the <code>spec</code> can take. In each case,
<code>::Date.spec</code> returns the first date in the period if <code>spec_type</code> is
<code>:from</code> and the last date in the period if <code>spec_type</code> is <code>:to</code>:</p>

<ul>
<li><code>YYYY-MM-DD</code> a particular date, so <code>:from</code> and <code>:to</code> return the same</li>
<li><code>YYYY</code> is the whole year <code>YYYY</code>,</li>
<li><code>YYYY-1H</code> or <code>YYYY-H1</code> is the first calendar half in year <code>YYYY</code>,</li>
<li><code>H2</code> or <code>2H</code> is the second calendar half of the current year,</li>
<li><code>YYYY-3Q</code> or <code>YYYY-Q3</code> is the third calendar quarter of year YYYY,</li>
<li><code>Q3</code> or <code>3Q</code> is the third calendar quarter in the current year,</li>
<li><code>YYYY-04</code> or <code>YYYY-4</code> is April, the fourth month of year <code>YYYY</code>,</li>
<li><code>4-12</code> or <code>04-12</code> is the 12th of April in the current year,</li>
<li><code>4</code> or <code>04</code> is April in the current year,</li>
<li><code>YYYY-W32</code> or <code>YYYY-32W</code> is the 32nd week in year YYYY,</li>
<li><code>W32</code> or <code>32W</code> is the 32nd week in the current year,</li>
<li><code>W32-4</code> or <code>32W-4</code> is the 4th day of the 32nd week in the current year,</li>
<li><code>YYYY-MM-A</code> or <code>YYYY-MM-B</code> is the first or second half of the given month,</li>
<li><code>YYYY-MM-i</code> or <code>YYYY-MM-v</code> is the first or fifth week of the given month,</li>
<li><code>YYYY-MM-I</code> or <code>YYYY-MM-V</code> is also the first or fifth week of the
given month, i.e., case does not matter,</li>
<li><code>MM-i</code> or <code>MM-v</code> is the first or fifth week of the current month,</li>
<li><code>YYYY-MM-3Tu</code> or <code>YYYY-MM-4Mo</code> or <code>YYYY-MM-3Tue</code> or <code>YYYY-MM-4Mon</code>
is the third Tuesdsay and fourth Monday of the given month,</li>
<li><code>MM-3Tu</code> or <code>MM-4Mo</code> (<code>MM-3Tue</code> or <code>MM-4Mon</code>) is the third Tuesdsay
and fourth Monday of the given month in the current year,</li>
<li><code>3Tu</code> or <code>4Mo</code> is the third Tuesdsay and fourth Monday of the current month,</li>
<li><code>YYYY-E</code> is Easter of the given year YYYY,</li>
<li><code>E</code> is Easter of the current year YYYY,</li>
<li><code>YYYY-E+50</code> and <code>YYYY-E-40</code> is 50 days after and 40 days before Easter of the given year,</li>
<li><code>E+50</code> and <code>E-40</code> is 50 days after and 40 days before Easter of the current year,</li>
<li><code>YYYY-001</code> and <code>YYYY-182</code> is first and 182nd day of the given year,</li>
<li><code>001</code> and <code>182</code> is first and 182nd day of the current year,</li>
<li><code>this_&lt;chunk&gt;</code> where <code>&lt;chunk&gt;</code> is one of <code>year</code>, <code>half</code>, <code>quarter</code>,
<code>bimonth</code>, <code>month</code>, <code>semimonth</code>, <code>biweek</code>, <code>week</code>, or <code>day</code>, the
corresponding calendar period in which the current date falls,</li>
<li><code>last_&lt;chunk&gt;</code> where <code>&lt;chunk&gt;</code> is one of <code>year</code>, <code>half</code>, <code>quarter</code>,
<code>bimonth</code>, <code>month</code>, <code>semimonth</code>, <code>biweek</code>, <code>week</code>, or <code>day</code>, the
corresponding calendar period immediately before the one in which the
current date falls,</li>
<li><code>today</code> is the same as <code>this_day</code>,</li>
<li><code>yesterday</code> is the same as <code>last_day</code>,</li>
<li><code>forever</code> is the period from ::Date::BOT to ::Date::EOT, essentially all
dates of commercial interest, and</li>
<li><code>never</code> causes the method to return nil.</li>
</ul>

<p>In all of the above example specs, the letter used for calendar
chunks, <code>W</code>, <code>Q</code>, and <code>H</code> can be written in lower case as well, as can
roman numeral week numbers. Also, you can use <code>/</code> to separate date
components instead of <code>-</code>.  Likewise, days of the week can be any
string, upper or lower case, that starts with at least two letters of
the day-of-week name: &#39;Su&#39;, &#39;su&#39;, &#39;sund&#39;, &#39;sunday&#39;, &#39;surgery&#39;, all are
valid ways of writing &#39;Sunday&#39;.</p>

<p>Each of the foregoing specs may have a &#39;skip modifier&#39; appended to it
for finding the following or preceding day-of-week from that date
given by the main spec.  A skip modifier is a construction appended to
a date spec of the form &#39;<Th', '>Th&#39;, &#39;&lt;=Th&#39;, or &#39;&gt;=Th&#39; where &#39;Th&#39;
could be the name of any day-of-the-week, as described in the
foregoing paragraph.  It means that /starting from the date determined
by the date spec/, find the first Thursday before (&lt;), on or before
(&lt;=), after (&gt;), or on or after (&gt;=) the date.  So Thanksgiving in
2028 could be found with Date.spec(&#39;2028-11&lt;=Th&#39;, :to), i.e.,
the last Thursday on or before the last day of November, 2028.</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <h4 class="tag_title">Examples:</h4>
    
      
      <pre class="example code"><code><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_spec'>spec</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>2012-W32</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_iso'>iso</span>      <span class='comment'># =&gt; &quot;2012-08-06&quot;
</span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_spec'>spec</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>2012-W32</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='symbol'>:to</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_iso'>iso</span> <span class='comment'># =&gt; &quot;2012-08-12&quot;
</span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_spec'>spec</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>W32</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_iso'>iso</span>           <span class='comment'># =&gt; &quot;2012-08-06&quot; if executed in 2012
</span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_spec'>spec</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>W32</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_iso'>iso</span>           <span class='comment'># =&gt; &quot;2012-08-04&quot; if executed in 2014</span></code></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>spec</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>#to_s</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>the spec to be interpreted as a calendar period</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>spec_type</span>
      
      
        <span class='type'>(<tt>Symbol</tt>, <tt>:from</tt>, <tt>:to</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>:from</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>return the first (:from) or last (:to)
date in the spec&#39;s period respectively</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Date.html" title="Date (class)">::Date</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>date that is the first (:from) or last (:to) in the period
designated by spec</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560
1561
1562
1563
1564
1565
1566
1567
1568
1569
1570
1571
1572
1573
1574
1575
1576
1577
1578
1579
1580
1581
1582
1583
1584
1585
1586
1587
1588
1589
1590
1591
1592
1593
1594
1595
1596
1597
1598
1599
1600
1601
1602
1603
1604
1605
1606
1607
1608
1609
1610
1611
1612
1613
1614
1615
1616
1617
1618
1619
1620
1621
1622
1623
1624
1625
1626
1627
1628
1629
1630
1631
1632
1633
1634
1635
1636
1637
1638
1639
1640
1641
1642
1643
1644
1645
1646
1647
1648
1649
1650
1651
1652
1653
1654
1655
1656
1657
1658
1659
1660
1661
1662
1663
1664
1665
1666
1667
1668
1669
1670
1671
1672
1673
1674
1675
1676
1677
1678
1679
1680
1681
1682
1683
1684
1685
1686
1687
1688
1689
1690
1691
1692
1693
1694
1695
1696
1697
1698
1699
1700
1701
1702
1703
1704
1705
1706
1707
1708
1709
1710
1711
1712
1713
1714
1715
1716
1717
1718
1719
1720
1721
1722
1723
1724
1725
1726
1727
1728
1729
1730
1731
1732
1733
1734
1735
1736
1737
1738
1739
1740
1741
1742
1743
1744
1745
1746
1747
1748
1749
1750
1751
1752</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/fat_date/date.rb', line 1549</span>

<span class='kw'>def</span> <span class='id identifier rubyid_spec'>spec</span><span class='lparen'>(</span><span class='id identifier rubyid_spec'>spec</span><span class='comma'>,</span> <span class='id identifier rubyid_spec_type'>spec_type</span> <span class='op'>=</span> <span class='symbol'>:from</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_spec'>spec</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_clean'>clean</span>
  <span class='kw'>unless</span> <span class='qsymbols_beg'>%i[</span><span class='tstring_content'>from</span><span class='words_sep'> </span><span class='tstring_content'>to</span><span class='tstring_end'>]</span></span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_spec_type'>spec_type</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid date spec type: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spec_type'>spec_type</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_today'>today</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span>
  <span class='kw'>if</span> <span class='lparen'>(</span><span class='id identifier rubyid_md'>md</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(?&lt;dir&gt;[&lt;&gt;]=?)(?&lt;dow&gt;Su|Mo|Tu|We|Th|Fr|Sa)[a-z]*\z</span><span class='regexp_end'>/i</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_skip_to'>skip_to</span> <span class='op'>=</span> <span class='id identifier rubyid_md'>md</span><span class='lbracket'>[</span><span class='symbol'>:dow</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_skip_dir'>skip_dir</span> <span class='op'>=</span> <span class='id identifier rubyid_md'>md</span><span class='lbracket'>[</span><span class='symbol'>:dir</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_spec'>spec</span> <span class='op'>=</span> <span class='id identifier rubyid_spec'>spec</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[&lt;&gt;]=?(Su|Mo|Tu|We|Th|Fr|Sa)[a-z]*\z</span><span class='regexp_end'>/i</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_skip_to'>skip_to</span> <span class='op'>=</span> <span class='kw'>nil</span>
    <span class='id identifier rubyid_skip_dir'>skip_dir</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_spec'>spec</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\A((?&lt;yr&gt;\d\d\d\d)[-/])?(?&lt;doy&gt;\d\d\d)\z</span><span class='regexp_end'>}</span></span>
      <span class='comment'># With 3-digit YYYY-ddd, return the day-of-year
</span>      <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:yr</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span>
      <span class='id identifier rubyid_doy'>doy</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:doy</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_max_doy'>max_doy</span> <span class='op'>=</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_gregorian_leap?'>gregorian_leap?</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='rparen'>)</span> <span class='op'>?</span> <span class='int'>366</span> <span class='op'>:</span> <span class='int'>365</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_doy'>doy</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_max_doy'>max_doy</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid day-of-year &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_doy'>doy</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; (1..</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_max_doy'>max_doy</span><span class='embexpr_end'>}</span><span class='tstring_content'>) in &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spec'>spec</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_doy'>doy</span> <span class='op'>-</span> <span class='int'>1</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\A((?&lt;yr&gt;\d\d\d\d)[-/])?(?&lt;mo&gt;\d\d?)([-/](?&lt;dy&gt;\d\d?))?\z</span><span class='regexp_end'>}</span></span>
      <span class='comment'># MM, YYYY-MM, MM-DD
</span>      <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:yr</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span>
      <span class='id identifier rubyid_month'>month</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:mo</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_day'>day</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:dy</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='kw'>unless</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>4</span><span class='comma'>,</span> <span class='int'>5</span><span class='comma'>,</span> <span class='int'>6</span><span class='comma'>,</span> <span class='int'>7</span><span class='comma'>,</span> <span class='int'>8</span><span class='comma'>,</span> <span class='int'>9</span><span class='comma'>,</span> <span class='int'>10</span><span class='comma'>,</span> <span class='int'>11</span><span class='comma'>,</span> <span class='int'>12</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_month'>month</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid month number (1-12): &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spec'>spec</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_day'>day</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span>
      <span class='kw'>elsif</span> <span class='id identifier rubyid_spec_type'>spec_type</span> <span class='op'>==</span> <span class='symbol'>:from</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_end_of_month'>end_of_month</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\A((?&lt;yr&gt;\d\d\d\d)[-/])?(?&lt;wk&gt;\d\d?)W(-(?&lt;dy&gt;\d))?\z</span><span class='regexp_end'>}xi</span></span><span class='comma'>,</span>
      <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\A((?&lt;yr&gt;\d\d\d\d)[-/])?W(?&lt;wk&gt;\d\d?)(-(?&lt;dy&gt;\d))?\z</span><span class='regexp_end'>}xi</span></span>
      <span class='comment'># Commercial week numbers.  The first commercial week of the year is
</span>      <span class='comment'># the one that includes the first Thursday of that year. In the
</span>      <span class='comment'># Gregorian calendar, this is equivalent to the week which includes
</span>      <span class='comment'># January 4.  This appears to be the equivalent of ISO 8601 week
</span>      <span class='comment'># number as described at https://en.wikipedia.org/wiki/ISO_week_date
</span>      <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:yr</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_week_num'>week_num</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:wk</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_day'>day</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:dy</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='kw'>unless</span> <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='int'>53</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_cover?'>cover?</span><span class='lparen'>(</span><span class='id identifier rubyid_week_num'>week_num</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid week number (1-53): &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spec'>spec</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_day'>day</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='int'>7</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_cover?'>cover?</span><span class='lparen'>(</span><span class='id identifier rubyid_day'>day</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid ISO day number (1-7): &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spec'>spec</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='kw'>if</span> <span class='id identifier rubyid_spec_type'>spec_type</span> <span class='op'>==</span> <span class='symbol'>:from</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_commercial'>commercial</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span> <span class='op'>?</span> <span class='id identifier rubyid_year'>year</span> <span class='op'>:</span> <span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_week_num'>week_num</span><span class='comma'>,</span> <span class='id identifier rubyid_day'>day</span> <span class='op'>?</span> <span class='id identifier rubyid_day'>day</span> <span class='op'>:</span> <span class='int'>1</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_commercial'>commercial</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span> <span class='op'>?</span> <span class='id identifier rubyid_year'>year</span> <span class='op'>:</span> <span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_week_num'>week_num</span><span class='comma'>,</span> <span class='id identifier rubyid_day'>day</span> <span class='op'>?</span> <span class='id identifier rubyid_day'>day</span> <span class='op'>:</span> <span class='int'>7</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>^((?&lt;yr&gt;\d\d\d\d)[-/])?(?&lt;qt&gt;\d)[Qq]$</span><span class='regexp_end'>}</span></span><span class='comma'>,</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>^((?&lt;yr&gt;\d\d\d\d)[-/])?[Qq](?&lt;qt&gt;\d)$</span><span class='regexp_end'>}</span></span>
      <span class='comment'># Year-Quarter
</span>      <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:yr</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span>
      <span class='id identifier rubyid_quarter'>quarter</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:qt</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='kw'>unless</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='int'>3</span><span class='comma'>,</span> <span class='int'>4</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_quarter'>quarter</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid quarter number (1-4): &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spec'>spec</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='id identifier rubyid_month'>month</span> <span class='op'>=</span> <span class='id identifier rubyid_quarter'>quarter</span> <span class='op'>*</span> <span class='int'>3</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_spec_type'>spec_type</span> <span class='op'>==</span> <span class='symbol'>:from</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_beginning_of_quarter'>beginning_of_quarter</span>
      <span class='kw'>else</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_end_of_quarter'>end_of_quarter</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>^((?&lt;yr&gt;\d\d\d\d)[-/])?(?&lt;hf&gt;\d)[Hh]$</span><span class='regexp_end'>}</span></span><span class='comma'>,</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>^((?&lt;yr&gt;\d\d\d\d)[-/])?[Hh](?&lt;hf&gt;\d)$</span><span class='regexp_end'>}</span></span>
      <span class='comment'># Year-Half
</span>      <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:yr</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span>
      <span class='id identifier rubyid_half'>half</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:hf</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid half number: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spec'>spec</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='id identifier rubyid_msg'>msg</span> <span class='kw'>unless</span> <span class='lbracket'>[</span><span class='int'>1</span><span class='comma'>,</span> <span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_half'>half</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_month'>month</span> <span class='op'>=</span> <span class='id identifier rubyid_half'>half</span> <span class='op'>*</span> <span class='int'>6</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_spec_type'>spec_type</span> <span class='op'>==</span> <span class='symbol'>:from</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>15</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_beginning_of_half'><span class='object_link'><a href="../Date.html#beginning_of_half-instance_method" title="FatDate::Date#beginning_of_half (method)">beginning_of_half</a></span></span>
      <span class='kw'>else</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_end_of_half'><span class='object_link'><a href="../Date.html#end_of_half-instance_method" title="FatDate::Date#end_of_half (method)">end_of_half</a></span></span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A(?&lt;yr&gt;\d\d\d\d)\z</span><span class='regexp_end'>/</span></span>
      <span class='comment'># Year only
</span>      <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:yr</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_spec_type'>spec_type</span> <span class='op'>==</span> <span class='symbol'>:from</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='int'>1</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='int'>12</span><span class='comma'>,</span> <span class='int'>31</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\A(((?&lt;yr&gt;\d\d\d\d)[-\/])?(?&lt;mo&gt;\d\d?)[-\/])?(?&lt;hf_mo&gt;(A|B))\z</span><span class='regexp_end'>}i</span></span>
      <span class='comment'># Year, month, half-month, designated with A or B
</span>      <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:yr</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span>
      <span class='id identifier rubyid_month'>month</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:mo</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_month'>month</span>
      <span class='id identifier rubyid_hf_mo'>hf_mo</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:hf_mo</span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_hf_mo'>hf_mo</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_spec_type'>spec_type</span> <span class='op'>==</span> <span class='symbol'>:from</span> <span class='op'>?</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>15</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='comment'># hf_mo == &quot;B&quot;
</span>        <span class='id identifier rubyid_spec_type'>spec_type</span> <span class='op'>==</span> <span class='symbol'>:from</span> <span class='op'>?</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>16</span><span class='rparen'>)</span> <span class='op'>:</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>16</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_end_of_month'>end_of_month</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\A((?&lt;yr&gt;\d\d\d\d)[-/])?((?&lt;mo&gt;\d\d?)[-/])?(?&lt;wk&gt;(i|ii|iii|iv|v|vi))\z</span><span class='regexp_end'>}i</span></span>
      <span class='comment'># Year, month, week-of-month, partial-or-whole, designated with lowercase Roman
</span>      <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:yr</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span>
      <span class='id identifier rubyid_month'>month</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:mo</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_month'>month</span>
      <span class='id identifier rubyid_wk'>wk</span> <span class='op'>=</span> <span class='id identifier rubyid_roman_to_week'>roman_to_week</span><span class='lparen'>(</span><span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:wk</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_spec_type'>spec_type</span> <span class='op'>==</span> <span class='symbol'>:from</span>
          <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_beginning_of_week'>beginning_of_week</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_wk'>wk</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_weeks'>weeks</span>
        <span class='kw'>else</span>
          <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_end_of_week'>end_of_week</span> <span class='op'>+</span> <span class='lparen'>(</span><span class='id identifier rubyid_wk'>wk</span> <span class='op'>-</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_weeks'>weeks</span>
        <span class='kw'>end</span>
      <span class='comment'># If beginning of week of the 1st is in prior month, return the 1st
</span>      <span class='id identifier rubyid_result'>result</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_max'>max</span>
      <span class='comment'># If the whole week of the result is in the next month, there was no such week
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_beginning_of_week'>beginning_of_week</span><span class='period'>.</span><span class='id identifier rubyid_month'>month</span> <span class='op'>&gt;</span> <span class='id identifier rubyid_month'>month</span>
        <span class='id identifier rubyid_msg'>msg</span> <span class='op'>=</span> <span class='id identifier rubyid_sprintf'>sprintf</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>no week number </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_wk'>wk</span><span class='embexpr_end'>}</span><span class='tstring_content'> in %04d-%02d</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='id identifier rubyid_msg'>msg</span>
      <span class='kw'>else</span>
        <span class='comment'># But if part of the result week is in this month, return end of month
</span>        <span class='lbracket'>[</span><span class='id identifier rubyid_result'>result</span><span class='comma'>,</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_end_of_month'>end_of_month</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_min'>min</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\A((?&lt;yr&gt;\d\d\d\d)[-/])?((?&lt;mo&gt;\d\d?)[-/])?((?&lt;nth&gt;[-+]?\d+)(?&lt;dow&gt;(Su|Mo|Tu|We|Th|Fr|Sa)[a-z]*))\z</span><span class='regexp_end'>}i</span></span>
      <span class='comment'># Year, month, ordinal dow name
</span>      <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:yr</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span>
      <span class='id identifier rubyid_month'>month</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:mo</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_month'>month</span>
      <span class='id identifier rubyid_nth'>nth</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:nth</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_wday'>wday</span> <span class='op'>=</span> <span class='id identifier rubyid_dow_to_wday'>dow_to_wday</span><span class='lparen'>(</span><span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:dow</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>unless</span> <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='int'>12</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_cover?'>cover?</span><span class='lparen'>(</span><span class='id identifier rubyid_month'>month</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid month number (1-12): &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_month'>month</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; in &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spec'>spec</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>unless</span> <span class='lparen'>(</span><span class='int'>1</span><span class='op'>..</span><span class='int'>5</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_cover?'>cover?</span><span class='lparen'>(</span><span class='id identifier rubyid_nth'>nth</span><span class='period'>.</span><span class='id identifier rubyid_abs'>abs</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>invalid ordinal day number (1-5): &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_nth'>nth</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; in &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spec'>spec</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>

      <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_nth_wday_in_year_month'>nth_wday_in_year_month</span><span class='lparen'>(</span><span class='id identifier rubyid_nth'>nth</span><span class='comma'>,</span> <span class='id identifier rubyid_wday'>wday</span><span class='comma'>,</span> <span class='id identifier rubyid_year'>year</span><span class='comma'>,</span> <span class='id identifier rubyid_month'>month</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\A(?&lt;yr&gt;\d\d\d\d[-/])?E(?&lt;off&gt;[+-]\d+)?\z</span><span class='regexp_end'>}i</span></span>
      <span class='comment'># Easter for the given year, current year (if no year component),
</span>      <span class='comment'># optionally plus or minus a day offset
</span>      <span class='id identifier rubyid_year'>year</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:yr</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_year'>year</span>
      <span class='id identifier rubyid_offset'>offset</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:off</span><span class='rbracket'>]</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>||</span> <span class='int'>0</span>
      <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_easter'>easter</span><span class='lparen'>(</span><span class='id identifier rubyid_year'>year</span><span class='rparen'>)</span> <span class='op'>+</span> <span class='id identifier rubyid_offset'>offset</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>%r{</span><span class='tstring_content'>\A(?&lt;rel&gt;(to[_-]?|this[_-]?)|(last[_-]?|yester[_-]?|next[_-]?))
            (?&lt;chunk&gt;morrow|day|week|biweek|fortnight|semimonth|bimonth|month|quarter|half|year)\z</span><span class='regexp_end'>}xi</span></span>
      <span class='id identifier rubyid_rel'>rel</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:rel</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_chunk'>chunk</span> <span class='op'>=</span> <span class='const'>Regexp</span><span class='period'>.</span><span class='id identifier rubyid_last_match'>last_match</span><span class='lbracket'>[</span><span class='symbol'>:chunk</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_chunk'>chunk</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>morrow</span><span class='regexp_end'>/i</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_chunk'>chunk</span> <span class='op'>=</span> <span class='symbol'>:day</span>
        <span class='id identifier rubyid_rel'>rel</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>next</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_chunk'>chunk</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>fortnight</span><span class='regexp_end'>/i</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_chunk'>chunk</span> <span class='op'>=</span> <span class='symbol'>:biweek</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_start'>start</span> <span class='op'>=</span>
        <span class='kw'>if</span> <span class='id identifier rubyid_rel'>rel</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>this|to</span><span class='regexp_end'>/i</span></span><span class='rparen'>)</span>
          <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span>
        <span class='kw'>elsif</span> <span class='id identifier rubyid_rel'>rel</span><span class='period'>.</span><span class='id identifier rubyid_match?'>match?</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>next</span><span class='regexp_end'>/i</span></span><span class='rparen'>)</span>
          <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_add_chunk'>add_chunk</span><span class='lparen'>(</span><span class='id identifier rubyid_chunk'>chunk</span><span class='comma'>,</span> <span class='int'>1</span><span class='rparen'>)</span>
        <span class='kw'>else</span>
          <span class='comment'># rel.match?(/last|yester/i)
</span>          <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='period'>.</span><span class='id identifier rubyid_today'>today</span><span class='period'>.</span><span class='id identifier rubyid_add_chunk'>add_chunk</span><span class='lparen'>(</span><span class='id identifier rubyid_chunk'>chunk</span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>1</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_spec_type'>spec_type</span> <span class='op'>==</span> <span class='symbol'>:from</span>
        <span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_beginning_of_chunk'>beginning_of_chunk</span><span class='lparen'>(</span><span class='id identifier rubyid_chunk'>chunk</span><span class='rparen'>)</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_start'>start</span><span class='period'>.</span><span class='id identifier rubyid_end_of_chunk'>end_of_chunk</span><span class='lparen'>(</span><span class='id identifier rubyid_chunk'>chunk</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^forever</span><span class='regexp_end'>/i</span></span>
      <span class='kw'>if</span> <span class='id identifier rubyid_spec_type'>spec_type</span> <span class='op'>==</span> <span class='symbol'>:from</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Date.html#BOT-constant" title="FatDate::Date::BOT (constant)">BOT</a></span></span>
      <span class='kw'>else</span>
        <span class='op'>::</span><span class='const'><span class='object_link'><a href="../../Date.html" title="Date (class)">Date</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Date.html#EOT-constant" title="FatDate::Date::EOT (constant)">EOT</a></span></span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^never</span><span class='regexp_end'>/i</span></span>
      <span class='kw'>nil</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>XXX bad date spec: &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_spec'>spec</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

  <span class='comment'># Now, skip to the next or preceding skip day if skip_to is defined.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_skip_to'>skip_to</span>
    <span class='id identifier rubyid_wday'>wday</span> <span class='op'>=</span> <span class='id identifier rubyid_dow_to_wday'>dow_to_wday</span><span class='lparen'>(</span><span class='id identifier rubyid_skip_to'>skip_to</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_wday'>wday</span> <span class='op'>==</span> <span class='id identifier rubyid_wday'>wday</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_skip_dir'>skip_dir</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>=</span><span class='tstring_end'>&#39;</span></span>
      <span class='kw'>true</span> <span class='comment'># Do nothing
</span>    <span class='kw'>elsif</span> <span class='id identifier rubyid_skip_dir'>skip_dir</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>&lt;</span><span class='tstring_end'>&#39;</span></span>
      <span class='comment'># Find prior date with dow
</span>      <span class='id identifier rubyid_result'>result</span> <span class='op'>-=</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span> <span class='kw'>while</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_wday'>wday</span> <span class='op'>!=</span> <span class='id identifier rubyid_wday'>wday</span>
    <span class='kw'>else</span>
      <span class='comment'># Find subsequent date with dow
</span>      <span class='id identifier rubyid_result'>result</span> <span class='op'>+=</span> <span class='int'>1</span><span class='period'>.</span><span class='id identifier rubyid_day'>day</span> <span class='kw'>while</span> <span class='id identifier rubyid_result'>result</span><span class='period'>.</span><span class='id identifier rubyid_wday'>wday</span> <span class='op'>!=</span> <span class='id identifier rubyid_wday'>wday</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_result'>result</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Dec 24 05:26:32 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.38 (ruby-3.4.1).
</div>

    </div>
  </body>
</html>